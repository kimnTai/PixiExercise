<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Week_1</title>
   <link rel="shortcut icon" href="./img/highwin_bell.png">
   <!-- bootstrap 5 CSS only -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
</head>

<body>
   <div style="background-image: url('./img/bg_final.png');height: 1080px;">
      <div style="position: absolute;top:235px;left:255px">
         <h1 style="color: aliceblue;">Week1 - 角子老虎機</h1>
         <div class="game"></div>
         <div class="mt-4" id="vueApp">
            <button class="me-3 btn btn-primary" @click='gameStart'>開始遊戲</button>
            <button v-if='this.running !== "" ' class="me-3 btn btn-primary" @click='gameControl' @keyup.enter="gameControl" >RUN</button>
         </div>
      </div>

   </div>



   <!-- Vue CDN -->
   <script src="https://unpkg.com/vue@next"></script>
   <!-- PIXI CDN -->
   <script src="https://pixijs.download/release/pixi.js"></script>
   <script>
      // PIXI app
      const app = new PIXI.Application({
         width: 1000, height: 570,
         backgroundAlpha: 0
      });
      document.querySelector('.game').appendChild(app.view);

      // Vue App
      const vueApp = Vue.createApp({
         data() {
            return {
               imgContainer: new PIXI.Container(),
               imgContainerB: new PIXI.Container(),
               imgUrlArray: [
                  './img/one.png',
                  './img/two.png',
                  './img/three.png',
                  './img/four.png',
                  // './img/highwin_bell.png'
               ],
               imgSize: 190,
               list: 5,
               runNumber: 0,
               running: '',
               speed: 10,
            }
         },
         methods: {
            // 設置圖片位置
            imgSet(imgContainer, place) {
               for (let j = 0; j < this.list; j++) {
                  for (let i = 0; i < 3; i++) {
                     // 產生０～４亂數
                     const randomNumber = Math.floor(Math.random() * this.imgUrlArray.length);
                     // 產生圖片
                     const img = new PIXI.Sprite.from(this.imgUrlArray[randomNumber]);
                     // 縮放設定
                     img.scale.set(this.imgSize / 200, this.imgSize / 200);
                     img.y = place + this.imgSize * i;
                     img.x = j * this.imgSize;
                     // 放入 Container
                     imgContainer.addChild(img);
                  }
               };
            },
            // ------ 開始遊戲 ------ 
            gameStart() {
               if (this.imgContainer.children.length > 0) return
               this.imgSet(this.imgContainer, 0);
               this.imgSet(this.imgContainerB, this.imgSize * -3);
               // 舞台放置
               app.stage.addChild(this.imgContainer);
               app.stage.addChild(this.imgContainerB);
               setTimeout(() => {
                  app.ticker.stop();
                  app.ticker.add(time => {
                     // if (this.speed >= 1) {
                     //    this.speed *= 0.998
                     // }
                     this.imgControl(this.imgContainer, 'A', this.speed)
                  }).add(time => {
                     // if (this.speed >= 1) {
                     //    this.speed *= 0.998
                     // }
                     this.imgControl(this.imgContainerB, 'B', this.speed)
                  });

                  this.running = false;
               }, 1000)
            },
            // 圖片交互 移動
            imgControl(imgContainer, sign, speed) {
               const size = this.imgSize * 3
               const runGrid = 10;

               // if (this.runNumber >= this.imgSize * runGrid * 2) {
               //    this.gameControl();
               //    this.runNumber = 0;
               //    this.speed = 10;
               // }
               imgContainer.y += speed;
               this.runNumber += speed;
               if (imgContainer.y >= size && sign == 'A') {
                  imgContainer.removeChildren();
                  this.imgSet(imgContainer, 0);
                  imgContainer.y = -size;
                  return
               }
               if (imgContainer.y >= size * 2 && sign == 'B') {
                  imgContainer.removeChildren();
                  this.imgSet(imgContainer, -size);
                  imgContainer.y = 0;
                  return
               }
            },
            gameControl() {
               this.runNumber = 0;
               switch (this.running) {
                  case true: this.running = false; app.ticker.stop(); break
                  case false: this.running = true; app.ticker.start(); break
                  case '': return
               };
            },

         },

      }).mount('#vueApp')
   </script>
</body>

</html>